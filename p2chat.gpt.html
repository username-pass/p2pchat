<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PeerJS Chat App</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
  <div>
    <label>Your ID:</label>
    <input type="text" id="your-id" readonly>
    <button onclick="generatePeerId()">Generate ID</button>
    <button onclick="copyIdToClipboard()">Copy ID</button>
  </div>
  
  <div>
    <label>Other User's ID:</label>
    <input type="text" id="other-id">
  </div>

  <div>
    <label>Message:</label>
    <input type="text" id="message">
    <button onclick="sendMessage()">Send</button>
  </div>

  <div>
    <h3>Chat History:</h3>
    <div id="chat-history"></div>
  </div>

  <script>
    var peer = new Peer();
    var conn;

    peer.on('open', function(id) {
      document.getElementById('your-id').value = id;
    });

    peer.on('connection', function(connection) {
      conn = connection;

      conn.on('data', function(data) {
        displayMessage('Other: ' + data);
      });
    });

    function generatePeerId() {
      var newPeerId = prompt('Enter your desired peer ID (alphanumeric characters, dashes, and underscores are allowed):');
      peer = new Peer(newPeerId);
    }

    function copyIdToClipboard() {
      var copyText = document.getElementById('your-id');
      copyText.select();
      document.execCommand('copy');
      alert('ID copied to clipboard!');
    }

    function sendMessage() {
      var message = document.getElementById('message').value;
      if (conn && message) {
        conn.send(message);
        displayMessage('You: ' + message);
        document.getElementById('message').value = '';
      }
    }

    function displayMessage(message) {
      var chatHistory = document.getElementById('chat-history');
      var messageElement = document.createElement('p');
      messageElement.textContent = message;
      chatHistory.appendChild(messageElement);
    }

    document.getElementById('other-id').addEventListener('input', function(event) {
      var otherPeerId = event.target.value;
      if (otherPeerId) {
        conn = peer.connect(otherPeerId);
        conn.on('open', function() {
          displayMessage('Connection established with ' + otherPeerId);
        });

        conn.on('data', function(data) {
          displayMessage('Other: ' + data);
        });
      }
    });
  </script>
</body>
</html>

